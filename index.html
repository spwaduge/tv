<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Shaka Player - Widevine</title>
  <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.3.5/dist/shaka-player.compiled.min.js"></script>
</head>
<body style="background:black; margin:0; display:flex; justify-content:center; align-items:center; height:100vh;">
  <video id="video" controls autoplay style="width:90%; max-width:960px; background:#000;"></video>

  <script>
    async function initPlayer() {
      const video = document.getElementById('video');
      const player = new shaka.Player(video);

      // Configure DRM settings
      player.configure({
        drm: {
          servers: {
            'com.widevine.alpha': 'https://iptv.umadiyajanani.com/viu/licence/?id=4&expires=1754287785'
          }
        },
        streaming: {
          retryParameters: { maxAttempts: 3 },
          startAtSegmentBoundary: true
        }
      });

      // Inject custom header into Widevine license request
      player.getNetworkingEngine().registerRequestFilter((type, request) => {
        if (type === shaka.net.NetworkingEngine.RequestType.LICENSE) {
          request.headers['User-Agent'] = 'Dalvik/2.1.0 (Linux; U; Android 0; 0 Build/0)';
        }
      });

      // Error handling
      player.addEventListener('error', e => {
        console.error('Error code', e.detail.code, 'object', e.detail);
      });

      try {
        // Load the manifest
        await player.load('https://iptv.umadiyajanani.com/viu/viu.mpd?id=1');
        console.log('The video has been loaded successfully!');
      } catch (err) {
        console.error('Failed to load the video', err);
      }
    }

    document.addEventListener('DOMContentLoaded', initPlayer);
  </script>
</body>
</html>
