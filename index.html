<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Widevine DASH Player</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.compiled.js"></script>
</head>
<body>
  <h2>DRM Protected Video Player</h2>
  <video id="video" width="720" controls autoplay></video>

  <script>
    async function initPlayer() {
      const manifestUri = 'https://iptv.umadiyajanani.com/viu/viu.mpd?id=4';
      const licenseServer = 'https://iptv.umadiyajanani.com/viu/licence/?id=4&expires=1754287785';

      const video = document.getElementById('video');
      const player = new shaka.Player(video);

      // Attach player to window for easy debugging
      window.player = player;

      // Listen for errors
      player.addEventListener('error', e => console.error('Error:', e.detail));

      // Configure DRM
      player.configure({
        drm: {
          servers: {
            'com.widevine.alpha': licenseServer,
          },
          advanced: {
            'com.widevine.alpha': {
              videoRobustness: 'SW_SECURE_CRYPTO',
              audioRobustness: 'SW_SECURE_CRYPTO',
              serverCertificate: null,
            },
          },
          clearKeys: {},
        },
        streaming: {
          retryParameters: { maxAttempts: 3 },
        },
        requestFilter: function(type, request) {
          if (type === shaka.net.NetworkingEngine.RequestType.LICENSE) {
            // Add User-Agent to license request
            request.headers['User-Agent'] = 'Dalvik/2.1.0 (Linux; U; Android 0; 0 Build/0)';
          }
        }
      });

      // Try to load a manifest.
      try {
        await player.load(manifestUri);
        console.log('Video loaded!');
      } catch (e) {
        console.error('Load error:', e);
      }
    }

    document.addEventListener('DOMContentLoaded', initPlayer);
  </script>
</body>
</html>
